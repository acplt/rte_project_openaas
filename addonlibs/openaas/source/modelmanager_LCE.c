/******************************************************************************
 *
 *   FILE
 *   ----
 *   nodeStoreFunctions.c
 *
 *   History
 *   -------
 *   2014-10-21   File created
 *
 *******************************************************************************
 *
 *   This file is generated by the 'acplt_builder' command
 *
 ******************************************************************************/

#ifndef OV_COMPILE_LIBRARY_openaas
#define OV_COMPILE_LIBRARY_openaas
#endif

#include "openaas.h"
#include "libov/ov_macros.h"
#include "libov/ov_result.h"


OV_DLLFNCEXPORT AASStatusCode openaas_modelmanager_createLCE(IdentificationType aasId, IdentificationType creatingInstance, IdentificationType writingInstance, OV_STRING eventClass, OV_STRING subject, DataValue data) {
	AASStatusCode result = AASSTATUSCODE_GOOD;
	OV_RESULT ovResult = OV_ERR_OK;
	OV_INSTPTR_openaas_aas paas = NULL;
	OV_INSTPTR_ov_object ptr = NULL;
	OV_INSTPTR_openaas_LifeCycleEntry lce = NULL;
	ptr = ov_path_getobjectpointer(openaas_modelmanager_AASConvertListGet(aasId), 2);
	if (!ptr)
		return AASSTATUSCODE_BADAASID;
	paas = Ov_StaticPtrCast(openaas_aas, ptr);
	if (paas){
		OV_STRING tmpString = NULL;
		OV_UINT count = paas->p_LifeCycleArchive.v_LifeCycleEntrySize+1;
		ov_string_print(&tmpString, "%u", count);
		ovResult = Ov_CreateObject(openaas_LifeCycleEntry, lce, &paas->p_LifeCycleArchive, tmpString);
		if(Ov_Fail(ovResult)){
			ov_logfile_error("Fatal: could not create LCE object - reason: %s", ov_result_getresulttext(ovResult));
			return openaas_modelmanager_ovresultToAASStatusCode(ovResult);
		}
		paas->p_LifeCycleArchive.v_LifeCycleEntrySize += 1;
		ov_string_setvalue(&(lce->v_CreatingInstanceString), creatingInstance.IdSpec);
		lce->v_CreatingInstanceType = creatingInstance.IdType;
		ov_string_setvalue(&(lce->v_WritingInstanceString), writingInstance.IdSpec);
		lce->v_WritingInstanceType = writingInstance.IdType;
		ov_string_setvalue(&(lce->v_EventClass), eventClass);
		ov_string_setvalue(&(lce->v_Subject), subject);
		ov_variable_setanyvalue(&(lce->v_Data), &data.Value);
		lce->v_TimeStamp = data.TimeStamp;
	}else{
		result = AASSTATUSCODE_BADUNEXPECTEDERROR;
	}
    return result;
}

OV_DLLFNCEXPORT AASStatusCode openaas_modelmanager_deleteLCE(IdentificationType aasId, OV_UINT64 lceId) {
	AASStatusCode result = AASSTATUSCODE_GOOD;
	OV_RESULT ovResult = OV_ERR_OK;
	OV_INSTPTR_openaas_aas paas = NULL;
	OV_INSTPTR_ov_object ptr = NULL;
	OV_INSTPTR_openaas_LifeCycleEntry lce = NULL;
	ptr = ov_path_getobjectpointer(openaas_modelmanager_AASConvertListGet(aasId), 2);
	if (!ptr)
		return AASSTATUSCODE_BADAASID;
	paas = Ov_StaticPtrCast(openaas_aas, ptr);
	if (paas){
		OV_STRING tmpString = NULL;
		ov_string_print(&tmpString, "%lu", lceId);
		lce = Ov_StaticPtrCast(openaas_LifeCycleEntry, Ov_SearchChild(ov_containment, &paas->p_LifeCycleArchive, tmpString));
		if(lce){
			ovResult = Ov_DeleteObject(lce);
			if(Ov_Fail(ovResult)){
				ov_logfile_error("Fatal: could not delete LCE object - reason: %s", ov_result_getresulttext(ovResult));
				return openaas_modelmanager_ovresultToAASStatusCode(result);
			}
		}else{
			result = AASSTATUSCODE_BADLCEID;
		}
	}else{
		result = AASSTATUSCODE_BADUNEXPECTEDERROR;
	}
    return result;
}



OV_DLLFNCEXPORT AASStatusCode openaas_modelmanager_getLCE(IdentificationType aasId, OV_UINT64 lceId, IdentificationType *creatingInstance, IdentificationType *writingInstance, OV_STRING *eventClass, OV_STRING *subject, DataValue *data) {
	OV_INSTPTR_openaas_aas paas = NULL;
	OV_INSTPTR_ov_object ptr = NULL;
	OV_INSTPTR_openaas_LifeCycleEntry lce = NULL;
	OV_STRING lceName = NULL;
	ptr = ov_path_getobjectpointer(openaas_modelmanager_AASConvertListGet(aasId), 2);
	if (!ptr)
		return AASSTATUSCODE_BADAASID;
	paas = Ov_StaticPtrCast(openaas_aas, ptr);
	if (paas){
		lceName = NULL;
		ov_string_print(&lceName, "%lu", lceId);
		lce = Ov_StaticPtrCast(openaas_LifeCycleEntry, Ov_SearchChild(ov_containment, Ov_StaticPtrCast(ov_domain, &paas->p_LifeCycleArchive), lceName));
		if (lce){
			ov_string_setvalue(&creatingInstance->IdSpec, lce->v_CreatingInstanceString);
			creatingInstance->IdType = lce->v_CreatingInstanceType;
			ov_string_setvalue(&writingInstance->IdSpec, lce->v_WritingInstanceString);
			writingInstance->IdType = lce->v_WritingInstanceType;
			ov_string_setvalue(eventClass, lce->v_EventClass);
			ov_string_setvalue(subject, lce->v_Subject);
			ov_variable_setanyvalue(&data->Value, &(lce->v_Data));
			data->TimeStamp = lce->v_TimeStamp;
		}else{
			return AASSTATUSCODE_BADLCEID;
		}
	}else{
		return AASSTATUSCODE_BADUNEXPECTEDERROR;
	}
	return AASSTATUSCODE_GOOD;
}


OV_DLLFNCEXPORT AASStatusCode openaas_modelmanager_getLastLCEs(IdentificationType aasId, OV_UINT count, IdentificationType **creatingInstance, IdentificationType **writingInstance, OV_STRING **eventClass, OV_STRING **subject, DataValue **data, OV_UINT *arrayDimension) {
	OV_INSTPTR_openaas_aas paas = NULL;
	OV_INSTPTR_ov_object ptr = NULL;
	OV_INSTPTR_openaas_LifeCycleEntry *lce = ov_database_malloc(sizeof(OV_INSTPTR_openaas_LifeCycleEntry)*count);
	ptr = ov_path_getobjectpointer(openaas_modelmanager_AASConvertListGet(aasId), 2);
	if (!ptr)
		return AASSTATUSCODE_BADAASID;
	paas = Ov_StaticPtrCast(openaas_aas, ptr);
	if (paas){
		ptr = Ov_GetLastChild(ov_containment, Ov_StaticPtrCast(ov_domain, &paas->p_LifeCycleArchive));
		if (ptr)
			return AASSTATUSCODE_BADLCEID;
		if (!Ov_CanCastTo(openaas_LifeCycleEntry, ptr))
			return AASSTATUSCODE_BADLCEID;
		lce[0] = Ov_StaticPtrCast(openaas_LifeCycleEntry, ptr);
		OV_UINT i = 0;
		for (i = 1; i < count; i++){
			ptr = Ov_GetPreviousChild(ov_containment, Ov_StaticPtrCast(ov_domain, ptr));
			if (ptr)
				break;
			if (!Ov_CanCastTo(openaas_LifeCycleEntry, ptr))
				return AASSTATUSCODE_BADLCEID;
			lce[i] = Ov_StaticPtrCast(openaas_LifeCycleEntry, ptr);
		}
		*creatingInstance = ov_database_malloc(sizeof(IdentificationType)*i);
		*writingInstance = ov_database_malloc(sizeof(IdentificationType)*i);
		*eventClass = ov_database_malloc(sizeof(OV_STRING)*i);
		*subject = ov_database_malloc(sizeof(OV_STRING)*i);
		*data = ov_database_malloc(sizeof(DataValue)*i);
		*arrayDimension = i;
		for (OV_UINT j = 0; j < i; j++){
			(*creatingInstance)[j].IdSpec = NULL;
			ov_string_setvalue(&(*creatingInstance)[j].IdSpec, lce[j]->v_CreatingInstanceString);
			(*creatingInstance)[j].IdType = lce[j]->v_CreatingInstanceType;
			(*writingInstance)[j].IdSpec = NULL;
			ov_string_setvalue(&(*writingInstance)[j].IdSpec, lce[j]->v_WritingInstanceString);
			(*writingInstance)[j].IdType = lce[j]->v_WritingInstanceType;
			(*eventClass)[j] = NULL;
			ov_string_setvalue(&(*eventClass)[j], lce[j]->v_EventClass);
			(*subject)[j] = NULL;
			ov_string_setvalue(&(*subject)[j], lce[j]->v_Subject);
			ov_variable_setanyvalue(&(*data)[j].Value, &(lce[j]->v_Data));
			(*data)[j].TimeStamp = lce[j]->v_TimeStamp;
			ov_database_free(lce[j]);
		}
	}else{
		return AASSTATUSCODE_BADUNEXPECTEDERROR;
	}
	return AASSTATUSCODE_GOOD;
}


OV_DLLFNCEXPORT AASStatusCode openaas_modelmanager_setLCE(IdentificationType aasId, OV_UINT64 lceId, IdentificationType creatingInstance, IdentificationType writingInstance, OV_STRING eventClass, OV_STRING subject, DataValue data) {
	OV_INSTPTR_openaas_aas paas = NULL;
	OV_INSTPTR_ov_object ptr = NULL;
	OV_INSTPTR_openaas_LifeCycleEntry lce = NULL;
	OV_STRING lceName = NULL;
	ptr = ov_path_getobjectpointer(openaas_modelmanager_AASConvertListGet(aasId), 2);
	if (!ptr)
		return AASSTATUSCODE_BADAASID;
	paas = Ov_StaticPtrCast(openaas_aas, ptr);
	if (paas){
		lceName = NULL;
		ov_string_print(&lceName, "%lu", lceId);
		lce = Ov_StaticPtrCast(openaas_LifeCycleEntry, Ov_SearchChild(ov_containment, Ov_StaticPtrCast(ov_domain, &paas->p_LifeCycleArchive), lceName));
		if (lce){
			ov_string_setvalue(&(lce->v_CreatingInstanceString), creatingInstance.IdSpec);
			lce->v_CreatingInstanceType = creatingInstance.IdType;
			ov_string_setvalue(&(lce->v_WritingInstanceString), writingInstance.IdSpec);
			lce->v_WritingInstanceType = writingInstance.IdType;
			ov_string_setvalue(&(lce->v_EventClass), eventClass);
			ov_string_setvalue(&(lce->v_Subject), subject);
			ov_variable_setanyvalue(&(lce->v_Data), &data.Value);
			lce->v_TimeStamp = data.TimeStamp;
		}else{
			return AASSTATUSCODE_BADLCEID;
		}
	}else{
		return AASSTATUSCODE_BADUNEXPECTEDERROR;
	}
	return AASSTATUSCODE_GOOD;
}
